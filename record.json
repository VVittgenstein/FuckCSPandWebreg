{
  "project_context": {
    "brief": "构建一个基于 Rutgers SOC 公开数据的选课查询与空位提醒网站，在“浏览/筛选课程 + 订阅空位提醒”场景下替代 CSP 和 WebReg 的日常使用体验，同时保持低运营成本与开源可一键部署能力。",
    "mvp_goal": "在每个部署环境内运行本地 SQLite 数据库 + 轻量 API 服务 + 前端 UI，实现针对多学期与多校区课程的浏览、多维筛选与邮箱/Discord 空位提醒闭环，并保持低运营成本与可在个人电脑/服务器一键部署。",
    "non_goals": [
      "不接入 WebReg 或任何需要登录的系统页面，不在本项目中执行自动选课/退课操作。",
      "不实现完整的学位规划、毕业审核或复杂先修关系校验，仅在 UI 展示先修与核心课程标签。",
      "不处理除邮箱地址与 Discord 标识之外的用户敏感信息，也不构建账号/登录体系。",
      "不承担对 Rutgers 官方课程与容量信息的权威解释责任，数据以官方 SOC 为准。",
      "MVP 不支持短信等额外通知渠道，仅聚焦邮箱和 Discord。",
      "MVP 不强求覆盖全部校区与研究生课程，具体范围后续确认。"
    ]
  },
  "md_source": "2025-11-11-dr.md",
  "generated_at": "2025-11-13T00:00:00Z",
  "tasks": {
    "T-20251113-soc-api-validation": {
      "seed_id": null,
      "title": "验证 Rutgers SOC API 参数、限流与字段行为",
      "type": "research",
      "summary": "围绕 C2、R-20251113-soc-api-change 与开放问题 Q-01，对 Rutgers SOC API 的参数组合、拉取全校课程的策略、速率限制与返回字段进行实测，产出可复用的调用指南，降低后续抓取脚本与通知轮询的风险。",
      "acceptance_draft": [
        "整理出在多学期、多校区场景下获取全部课程的推荐调用策略（例如按 term + campus / subject 分批），并估算完整抓取一次全量以及常规增量更新所需时间。",
        "记录 SOC API 的关键参数与典型响应样例，确认字段覆盖 FR-01/FR-02 所需信息，并标记可能缺失或不稳定的字段。",
        "通过高频调用实验观察速率限制与错误码，给出可接受的最大抓取与轮询频率建议，并形成一份内部说明文档。"
      ],
      "lane": "now",
      "priority_suggested": "P0",
      "status": "in_progress",
      "dependencies": [],
      "blocked": true,
      "blocked_by": [
        {
          "dep_id": "DEP-001",
          "name": "Rutgers SOC API（courses.json / openSections）",
          "type": "api",
          "status": "unknown",
          "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
          "note": "需要在开发前期通过实测确认可用参数、速率限制和结构稳定性。"
        }
      ],
      "unblock_plan": "先搭建 scripts/soc_probe.ts CLI 与 configs/soc_probe.sample.json，通过 mock 测试验证参数解析，再逐步扩展到限流压测脚本与 contract 生成脚本，最后把 validate:soc-api 命令接入 CI。",
      "estimate_h": 4,
      "risk": "high",
      "confidence": 0.65,
      "interfaces_touched": [
        "data-source",
        "tooling",
        "observability"
      ],
      "artifacts": [
        "scripts/soc_probe.ts",
        "scripts/soc_rate_bench.ts",
        "scripts/soc_contract_report.ts",
        "configs/soc_probe.sample.json",
        "tests/soc_probe.spec.ts",
        "tests/soc_rate_bench.spec.ts",
        "tests/soc_contract.test.ts",
        "docs/soc_api_contract.json",
        "artifacts/soc_rate_report.json"
      ],
      "citations": [
        "EVID-001",
        "EVID-002",
        "R-20251113-soc-api-change",
        "Q-01"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-16T02:55:01Z",
      "owner": "codex",
      "tags": [
        "coding",
        "soc-api",
        "cli"
      ],
      "subtasks": {
        "T-20251113-soc-api-validation-ST-01": {
          "seed_id": null,
          "title": "实现 SOC API 探测 CLI 并生成原始快照",
          "type": "coding",
          "summary": "编写 scripts/soc_probe.ts 命令行工具，按照配置遍历 term/campus/subject 组合并将原始响应保存到 data/raw 下，形成后续建库与通知任务可直接消费的真实输入。",
          "acceptance_draft": [
            "提供 configs/soc_probe.sample.json 以声明 term/campus/subject 组合，运行 `pnpm ts-node scripts/soc_probe.ts --config configs/soc_probe.sample.json` 会在 `data/raw/<term>-<campus>.json` 下生成最新快照并打印成功统计。",
            "CLI 将每个请求的状态码与耗时写入 `logs/soc_probe.log`，任一调用失败时进程退出非零状态，便于 CI/cron 直接感知异常。",
            "补充最小回归测试（如 tests/soc_probe.spec.ts）和 HTTP mock fixture，验证参数解析与文件持久化逻辑可在 CI 中稳定运行。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "done",
          "dependencies": [],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "通过低频访问逐个尝试参数组合，记录返回结构与速记笔记，整理成统一的 API 资源/参数地图。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.65,
          "interfaces_touched": [
            "data-source",
            "docs"
          ],
          "artifacts": [
            "scripts/soc_probe.ts",
            "configs/soc_probe.sample.json",
            "tests/soc_probe.spec.ts",
            "README.md",
            "Compact/Compact-T-20251113-soc-api-validation-ST-01-2025-11-16-T021218Z.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "R-20251113-soc-api-change",
            "Q-01"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-16T02:56:44Z",
          "owner": "codex",
          "tags": [
            "subtask",
            "soc-api",
            "research"
          ]
        },
        "T-20251113-soc-api-validation-ST-02": {
          "seed_id": null,
          "title": "构建限流与稳健性压测脚本",
          "type": "coding",
          "summary": "在 scripts/soc_rate_bench.ts 中复用探测逻辑，按指定并发度与速率对 SOC API 做压测，生成包含限流阈值与错误码的机器可读报告。",
          "acceptance_draft": [
            "脚本支持 `--concurrency`、`--duration`、`--terms` 等参数，执行后会在 `artifacts/soc_rate_report.json` 写入吞吐量、失败率、限流窗口等统计。",
            "压测过程中捕捉 HTTP 错误码与速率限制 header，将第一次和最后一次被限流的时间戳打印到控制台并写入报告。",
            "提供 `--dry-run` 模式与 tests/soc_rate_bench.spec.ts，用 mock HTTP server 验证参数校验与节流逻辑，保证 CI 可运行。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [],
          "blocked": true,
          "blocked_by": [
            {
              "dep_id": "DEP-001",
              "name": "Rutgers SOC API（courses.json / openSections）",
              "type": "api",
              "status": "unknown",
              "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
              "note": "需要在开发前期通过实测确认可用参数、速率限制和结构稳定性。"
            }
          ],
          "unblock_plan": "在受控环境运行调用矩阵，逐步提升速率观察限流表现，将数据记录到 docs/soc_api_test_report.md。",
          "estimate_h": 3,
          "risk": "high",
          "confidence": 0.6,
          "interfaces_touched": [
            "data-source",
            "observability",
            "docs"
          ],
          "artifacts": [
            "docs/soc_api_test_report.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "R-20251113-soc-api-change",
            "Q-01"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "soc-api",
            "research"
          ]
        },
        "T-20251113-soc-api-validation-ST-03": {
          "seed_id": null,
          "title": "导出可机读的字段映射与契约测试",
          "type": "coding",
          "summary": "基于 data/raw 快照生成字段映射 JSON，并在测试中验证 FR-01/FR-02 所需字段存在与类型稳定，为抓取脚本提供持续可运行的契约保障。",
          "acceptance_draft": [
            "实现 scripts/soc_contract_report.ts，将最新 `data/raw/*.json` 汇总为 `docs/soc_api_contract.json`，记录字段层级、数据类型、是否稳定存在。",
            "新增 tests/soc_contract.test.ts，读取 contract JSON 并对课程标题、课程号、容量、meeting 信息等关键字段做断言，缺失时测试失败。",
            "把 contract 生成与校验封装到 `pnpm run validate:soc-api` 命令，供抓取、通知与 CI 复用。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-soc-api-validation-ST-01",
            "T-20251113-soc-api-validation-ST-02"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "在资源映射与限流实验完成后，沉淀为统一的调用手册并与抓取/轮询脚本对齐。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "docs",
            "build-script",
            "data-source"
          ],
          "artifacts": [
            "docs/soc_api_handbook.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "R-20251113-soc-api-change",
            "Q-01"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "soc-api",
            "research"
          ]
        }
      }
    },
    "T-20251113-act-001-soc-json-scraper": {
      "seed_id": "ACT-001",
      "title": "封装 Rutgers SOC 数据抓取与本地数据库初始化脚本",
      "type": "coding",
      "summary": "基于 D-20251113-data-source-soc，从 Rutgers SOC 接口按学期与校区批量抓取课程与 Section，使用事务将结果写入本地 SQLite 数据库，为查询 API 与通知进程提供统一数据源，并验证字段覆盖 FR-01/FR-02。",
      "acceptance_draft": [
        "脚本支持以 term + campus 为输入，或接收 term/campus 列表批量处理，针对每个组合调用 SOC API 并将课程/Section 写入 SQLite 数据库（事务 + 幂等 upsert），失败时提供重试与清晰错误日志。",
        "数据库中的 courses/sections 等表字段覆盖 FR-01/FR-02 中列出的关键字段（课程标题、代码、学分、院系、Index、Section、时间地点、核心代码、先修、授课模式等），随机抽样 ≥10 门课与官方 SOC 页面比对值一致。",
        "脚本输出更新摘要（新增/更新/删除条数、学期/校区范围），支持“全量初始化”和“增量更新”两种模式，增量模式仅替换状态发生变化的记录。"
      ],
      "lane": "now",
      "priority_suggested": "P0",
      "status": "todo",
      "dependencies": [
        "T-20251113-act-007-local-db-schema"
      ],
      "blocked": true,
      "blocked_by": [
        {
          "dep_id": "DEP-001",
          "name": "Rutgers SOC API（courses.json / openSections）",
          "type": "api",
          "status": "unknown",
          "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
          "note": "接口无正式公开文档，速率限制与长期稳定性未知；结构或访问策略变更将直接影响数据抓取与通知准确性。"
        }
      ],
      "unblock_plan": "先完成 T-20251113-soc-api-validation 与 T-20251113-act-007-local-db-schema，锁定字段/索引定义后再实现写入与增量更新逻辑，并在 CI 中加入数据库一致性校验。",
      "estimate_h": 6,
      "risk": "high",
      "confidence": 0.7,
      "interfaces_touched": [
        "data-source",
        "database",
        "build-script"
      ],
      "artifacts": [
        "scripts/fetch_soc_data.ts",
        "data/courses.sqlite"
      ],
      "citations": [
        "EVID-001",
        "EVID-002",
        "R-20251113-soc-api-change",
        "#md-4-1-fr-01"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-001",
        "backend",
        "soc-api",
        "data-pipeline"
      ],
      "subtasks": {
        "T-20251113-act-001-soc-json-scraper-ST-01": {
          "seed_id": null,
          "title": "实现批量抓取 CLI 并持久化原始 JSON",
          "type": "coding",
          "summary": "封装 scripts/fetch_soc.ts，将 term/campus/subject 组合串行或并行调用 SOC API，输出 data/raw/* 目录与 manifest，供建库与测试直接使用。",
          "acceptance_draft": [
            "运行 `pnpm ts-node scripts/fetch_soc.ts --terms 2024FA,2024SP --campuses NB --subjects CS,EE` 会在 `data/raw/<term>/<campus>/<subject>.json` 下生成文件，并写入 `data/raw/manifest.json` 记录哈希与时间戳。",
            "CLI 支持断点续跑（基于 manifest 跳过未过期的快照）并提供 `--force` 参数强制刷新，失败时会清理半成品文件。",
            "新增 tests/fetch_soc.spec.ts，使用 HTTP mock 验证批次划分、重试与 manifest 读写逻辑。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-007-local-db-schema"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "参考 schema 设计与 API 要求，整理建库完成的清单并约定验证方式。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "database",
            "docs"
          ],
          "artifacts": [
            "docs/db/ready_checklist.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "R-20251113-soc-api-change",
            "#md-4-1-fr-01"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "data-pipeline",
            "database"
          ]
        },
        "T-20251113-act-001-soc-json-scraper-ST-02": {
          "seed_id": null,
          "title": "编写 JSON→SQLite 转换器与初始化脚本",
          "type": "coding",
          "summary": "实现 scripts/seed_sqlite.ts，读取 data/raw 快照并通过事务写入 SQLite，创建课程、section、meeting、订阅等表及必要索引。",
          "acceptance_draft": [
            "执行 `pnpm ts-node scripts/seed_sqlite.ts --raw data/raw/2024FA --db data/app.db` 会生成/更新数据库，输出每张表的写入条数与耗时。",
            "脚本在字段缺失或约束失败时能回滚事务并返回错误码，避免落地半成品数据库。",
            "添加 tests/seed_sqlite.integration.ts，使用 sample fixture 验证所有表/索引存在且数据与输入快照一致。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-001-soc-json-scraper-ST-01",
            "T-20251113-soc-api-validation"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "结合 API 调用手册与 schema 模型，绘制端到端流程并标注每一步的输入输出与幂等策略。",
          "estimate_h": 3,
          "risk": "mid",
          "confidence": 0.65,
          "interfaces_touched": [
            "data-source",
            "database",
            "build-script"
          ],
          "artifacts": [
            "docs/data_pipeline/init_flow.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "R-20251113-soc-api-change",
            "#md-4-1-fr-01"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "data-pipeline"
          ]
        },
        "T-20251113-act-001-soc-json-scraper-ST-03": {
          "seed_id": null,
          "title": "封装一键建库流程并加入 CI 校验",
          "type": "coding",
          "summary": "使用 Makefile 或 package script 串联抓取与建库，提供单命令刷新数据库的流程，并在 CI 中通过缩减数据运行一次烟囱测试。",
          "acceptance_draft": [
            "新增 `make refresh-db TERM=2024FA CAMPUS=NB`（或 `pnpm run db:refresh`），串联 fetch_soc 与 seed_sqlite，完成后自动运行 `sqlite3 data/app.db \"SELECT count(*) FROM courses;\"` 作为校验。",
            "在 `.github/workflows/db-refresh.yml` 或 scripts/ci_db_refresh.sh 中加入缩减数据烟囱测试，自动上传 `data/app.db` 作为 artifact。",
            "在 README/docs/development.md 记录上述命令、依赖与常见问题，让新开发者 clone 后可直接运行同一流程。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-001-soc-json-scraper-ST-01",
            "T-20251113-act-001-soc-json-scraper-ST-02"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "基于 ready checklist 与流程设计，整理验收脚本、告警与重建策略，写入统一文档。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "database",
            "build-script",
            "observability"
          ],
          "artifacts": [
            "docs/data_pipeline/rebuild_policy.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "R-20251113-soc-api-change",
            "#md-4-1-fr-01"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "data-pipeline",
            "ops"
          ]
        }
      }
    },
    "T-20251113-act-002-frontend-filter-mvp": {
      "seed_id": "ACT-002",
      "title": "实现基于本地查询 API 的课程列表与多维筛选（MVP）",
      "type": "coding",
      "summary": "前端 SPA 不再一次性加载全部课程 JSON，而是通过本地查询 API 按需请求课程/Section 数据，提供与 FR-01/FR-02/FR-03 对齐的多维筛选、周视图及分页体验，确保 UI 与数据库保持一致。",
      "acceptance_draft": [
        "用户选择 term + campus 后，前端调用本地 API 拉取分页课程/Section 数据并展示完整字段，随机抽样 ≥10 门课核对与 SOC 数据库存储一致。",
        "筛选 UI 支持标题/代码关键字、学分、院系、课程层次、先修、核心代码、Index/Section、教师、状态、星期/时间区间、校区/教学楼/教室、授课模式等字段的单条件与多条件组合，前端会将条件映射为 API 查询参数并保证结果一致。",
        "在约 4500 门课程（含 1 万+ Section）的数据量下，常见筛选、分页与视图切换的“API 往返 + 前端渲染”整体响应 < 0.5 秒；当本地 API 不可用时给出明确的错误提示。"
      ],
      "lane": "now",
      "priority_suggested": "P0",
      "status": "todo",
      "dependencies": [
        "T-20251113-act-001-soc-json-scraper",
        "T-20251113-act-008-local-query-api"
      ],
      "blocked": false,
      "blocked_by": [],
      "unblock_plan": "",
      "estimate_h": 8,
      "risk": "mid",
      "confidence": 0.7,
      "interfaces_touched": [
        "frontend",
        "api-client",
        "filter-logic",
        "calendar-view"
      ],
      "artifacts": [
        "src/pages/courses.tsx",
        "src/components/filters/*",
        "src/components/calendar-view/*",
        "src/api/hooks/useCourses.ts"
      ],
      "citations": [
        "EVID-001",
        "EVID-002",
        "EVID-006",
        "R-20251113-frontend-perf",
        "D-20251113-arch-static-frontend-b"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-002",
        "frontend",
        "filter",
        "mvp"
      ],
      "subtasks": {
        "T-20251113-act-002-frontend-filter-mvp-ST-01": {
          "seed_id": null,
          "title": "搭建课程检索页面骨架与数据源",
          "type": "coding",
          "summary": "创建 web/src/pages/CourseSearchPage.tsx，并通过 hook 连接本地 /api/courses，确保 `pnpm dev` 下可访问和加载课程列表。",
          "acceptance_draft": [
            "在路由表中注册 `/courses` 页面并完成基本布局，含列表容器与筛选面板占位。",
            "实现 `useCoursesQuery` 等数据获取 hook，能够读取 term/campus 参数并呈现加载与错误状态。",
            "编写 Playwright 或 Vitest 烟囱测试，用 mock server 验证页面渲染会触发一次 /api/courses 调用并展示响应数据。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-008-local-query-api"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "结合 API 能力与用户场景整理字段清单，并抽象成可被前端/文档共享的数据结构。",
          "estimate_h": 3,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "frontend",
            "ux",
            "api"
          ],
          "artifacts": [
            "docs/ux/filter_field_catalog.md",
            "src/config/filterFields.ts"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "EVID-006",
            "R-20251113-frontend-perf",
            "D-20251113-arch-static-frontend-b"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "frontend",
            "ux"
          ]
        },
        "T-20251113-act-002-frontend-filter-mvp-ST-02": {
          "seed_id": null,
          "title": "实现多维筛选面板与状态容器",
          "type": "coding",
          "summary": "开发 subject/level/credits/keyword 等筛选组件，与 Zustand/Recoil 等状态容器绑定，实现筛选条件的保存、重置与 URL 同步。",
          "acceptance_draft": [
            "在 `web/src/components/filters` 下实现独立组件，并通过统一的 `FilterGroup` 结构渲染。",
            "创建 `useCourseFilterStore` 管理筛选条件，支持持久化到 URL query 与快速重置。",
            "为每个筛选组件补充单元测试，验证用户交互会更新 store 并触发订阅回调。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-002-frontend-filter-mvp-ST-01",
            "T-20251113-act-008-local-query-api"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "基于字段目录推导用户问题模板，并定义 UI → API 参数的映射逻辑。",
          "estimate_h": 3,
          "risk": "mid",
          "confidence": 0.65,
          "interfaces_touched": [
            "frontend",
            "api",
            "ux"
          ],
          "artifacts": [
            "docs/ux/filter_mapping.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "EVID-006",
            "R-20251113-frontend-perf",
            "D-20251113-arch-static-frontend-b"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "frontend",
            "mapping"
          ]
        },
        "T-20251113-act-002-frontend-filter-mvp-ST-03": {
          "seed_id": null,
          "title": "连通列表渲染、分页与结果断言",
          "type": "coding",
          "summary": "将筛选状态与课程列表联动，支持分页/虚拟列表、空状态与表头排序，并用 e2e 测试验证筛选结果真实生效。",
          "acceptance_draft": [
            "CourseResultsTable 渲染 FR-01/FR-02 所需列（课程号、标题、教授、容量等），支持千条数据下的虚拟滚动或分页。",
            "筛选条件变化会触发 useCoursesQuery 重新请求并刷新列表，同时在空结果与错误时显示对应的 UI。",
            "新增 `pnpm test:e2e --filter course-search`，用 Playwright 模拟调整 subject/keyword 等筛选并断言所见课程发生变化。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-002-frontend-filter-mvp-ST-01",
            "T-20251113-act-002-frontend-filter-mvp-ST-02"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "结合 UI 原型与性能目标，定义筛选反馈策略与文案。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "frontend",
            "ux",
            "observability"
          ],
          "artifacts": [
            "docs/ux/filter_feedback.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "EVID-006",
            "R-20251113-frontend-perf",
            "D-20251113-arch-static-frontend-b"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "frontend",
            "ux"
          ]
        }
      }
    },
    "T-20251113-act-003-mail-notify-function": {
      "seed_id": "ACT-003",
      "title": "实现课程空位邮件通知功能（本地定时任务）",
      "type": "coding",
      "summary": "依据 D-20251113-notify-channels-email-discord，在每个部署环境中运行本地后台进程定期轮询 SOC openSections，结合本地数据库中的订阅记录判断 Closed→Open 事件，并通过可配置的邮件发送模块通知用户，满足 FR-04/FR-05/FR-06 与 NFR-02 的延迟与可靠性要求。",
      "acceptance_draft": [
        "在本地测试环境模拟 Closed→Open 场景时，记录从状态变化到邮件发送的时间，平均延迟 < 30 秒、最大延迟 < 60 秒，且同一开放事件同一邮箱只收到 1 封邮件。",
        "邮件正文包含课程名称、Index、Section、上课时间地点与订阅人信息，并提供安全的本地退订/管理链接；退订后同一订阅不再收到后续通知。",
        "本地通知进程支持自定义轮询频率、日志与错误重试，能够在网络异常/进程重启后恢复状态，不会静默丢失事件。"
      ],
      "lane": "now",
      "priority_suggested": "P0",
      "status": "todo",
      "dependencies": [
        "T-20251113-act-009-subscription-management",
        "T-20251113-act-010-local-polling-notify",
        "T-20251113-act-011-mail-sender-module"
      ],
      "blocked": true,
      "blocked_by": [
        {
          "dep_id": "DEP-001",
          "name": "Rutgers SOC API（courses.json / openSections）",
          "type": "api",
          "status": "unknown",
          "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
          "note": "接口无正式公开文档，速率限制与长期稳定性未知；若访问策略收紧，将影响通知准确性。"
        },
        {
          "dep_id": "DEP-002",
          "name": "SendGrid 或同类邮件发送服务",
          "type": "api",
          "status": "approved",
          "doc_url": "",
          "note": "免费额度有限且需要正确配置发件域名与内容策略，以降低被判为垃圾邮件的风险。"
        }
      ],
      "unblock_plan": "基于 T-20251113-act-010-local-polling-notify 提供的轮询结果与 T-20251113-act-011-mail-sender-module 中的发送适配器，设计本地 cron/worker，验证多次重试与恢复逻辑后再开放配置。",
      "estimate_h": 8,
      "risk": "high",
      "confidence": 0.65,
      "interfaces_touched": [
        "local-service",
        "notification-service",
        "email-provider",
        "scheduler"
      ],
      "artifacts": [
        "services/notifier/email_worker.ts",
        "templates/email/*",
        "config/email.json"
      ],
      "citations": [
        "EVID-001",
        "EVID-003",
        "EVID-005",
        "R-20251113-notify-delay",
        "R-20251113-spam"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-003",
        "backend",
        "email",
        "notification"
      ],
      "subtasks": {
        "T-20251113-act-003-mail-notify-function-ST-01": {
          "seed_id": null,
          "title": "实现空位事件队列与邮件任务入库",
          "type": "coding",
          "summary": "在 notifier 目录新增 emailQueueWorker，监听 openSections 事件并写入 SQLite/email_jobs 队列表，为后续发送模块提供可运行的数据来源。",
          "acceptance_draft": [
            "创建 `notifier/src/emailQueueWorker.ts`，暴露 `pnpm ts-node notifier/src/emailQueueWorker.ts --run-once` 命令，将轮询服务推送的 openSections 事件转换为 email_jobs 记录。",
            "email_jobs 表包含订阅 ID、section 状态、模板变量、重试计数等字段，并通过 migration 文件创建。",
            "使用 sqlite-memory + mock 事件写入的集成测试，验证 worker 能够去重并正确标记 pending 状态。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-009-subscription-management",
            "T-20251113-act-010-local-polling-notify",
            "T-20251113-act-011-mail-sender-module"
          ],
          "blocked": true,
          "blocked_by": [
            {
              "dep_id": "DEP-001",
              "name": "Rutgers SOC API（courses.json / openSections）",
              "type": "api",
              "status": "unknown",
              "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
              "note": "接口无正式公开文档，速率限制与长期稳定性未知；若访问策略收紧，将影响通知准确性。"
            },
            {
              "dep_id": "DEP-002",
              "name": "SendGrid 或同类邮件发送服务",
              "type": "api",
              "status": "approved",
              "doc_url": "",
              "note": "免费额度有限且需要正确配置发件域名与内容策略，以降低被判为垃圾邮件的风险。"
            }
          ],
          "unblock_plan": "依赖订阅模型与事件语义，先定义模板所需字段与映射，形成标准通知单元。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.6,
          "interfaces_touched": [
            "notification-service",
            "email-provider"
          ],
          "artifacts": [
            "docs/notify/mail_mapping.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-003",
            "EVID-005",
            "R-20251113-notify-delay",
            "R-20251113-spam"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "notification",
            "email"
          ]
        },
        "T-20251113-act-003-mail-notify-function-ST-02": {
          "seed_id": null,
          "title": "实现邮件模板渲染与发送适配器",
          "type": "coding",
          "summary": "抽象 MailSender 接口，提供本地 SMTP 与 SendGrid mock 实现，并使用多语言模板生成 HTML/Plain 文本。",
          "acceptance_draft": [
            "在 `notifier/src/mailers` 下实现模板渲染器，读取 `templates/email/{locale}`，产出 HTML 与文本版本。",
            "封装 `MailSender` 接口并提供 SMTP 与 SendGrid 两种实现，通过环境变量切换。",
            "使用 mailhog/mock-smtp 的集成测试验证模板渲染与发送路径，`pnpm test mailer` 需通过。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-003-mail-notify-function-ST-01",
            "T-20251113-act-011-mail-sender-module"
          ],
          "blocked": true,
          "blocked_by": [
            {
              "dep_id": "DEP-001",
              "name": "Rutgers SOC API（courses.json / openSections）",
              "type": "api",
              "status": "unknown",
              "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
              "note": "接口无正式公开文档，速率限制与长期稳定性未知；若访问策略收紧，将影响通知准确性。"
            },
            {
              "dep_id": "DEP-002",
              "name": "SendGrid 或同类邮件发送服务",
              "type": "api",
              "status": "approved",
              "doc_url": "",
              "note": "免费额度有限且需要正确配置发件域名与内容策略，以降低被判为垃圾邮件的风险。"
            }
          ],
          "unblock_plan": "结合事件命中分布与邮件服务速率，给出收件人批处理策略。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.6,
          "interfaces_touched": [
            "notification-service",
            "email-provider",
            "scheduler"
          ],
          "artifacts": [
            "docs/notify/mail_batching.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-003",
            "EVID-005",
            "R-20251113-notify-delay",
            "R-20251113-spam"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "notification",
            "email"
          ]
        },
        "T-20251113-act-003-mail-notify-function-ST-03": {
          "seed_id": null,
          "title": "落地发送调度与重试流程",
          "type": "coding",
          "summary": "实现 emailDispatcher 常驻进程，按配置频率扫描待发送任务、调用 MailSender 并记录重试/失败信息。",
          "acceptance_draft": [
            "提供 `pnpm ts-node notifier/src/emailDispatcher.ts --interval 30` 命令，按固定频率拉取 pending 任务并调用 MailSender。",
            "dispatcher 会追踪重试次数与最后一次错误原因，超过阈值自动标记 failed 并写日志。",
            "编写 sqlite-memory + mock sender 的集成测试，验证 pending→sent/failed 状态流转与重试策略。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-003-mail-notify-function-ST-01",
            "T-20251113-act-010-local-polling-notify"
          ],
          "blocked": true,
          "blocked_by": [
            {
              "dep_id": "DEP-001",
              "name": "Rutgers SOC API（courses.json / openSections）",
              "type": "api",
              "status": "unknown",
              "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
              "note": "接口无正式公开文档，速率限制与长期稳定性未知；若访问策略收紧，将影响通知准确性。"
            },
            {
              "dep_id": "DEP-002",
              "name": "SendGrid 或同类邮件发送服务",
              "type": "api",
              "status": "approved",
              "doc_url": "",
              "note": "免费额度有限且需要正确配置发件域名与内容策略，以降低被判为垃圾邮件的风险。"
            }
          ],
          "unblock_plan": "结合轮询延迟与订阅体验，确定 SLO、冷却与监控策略。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.65,
          "interfaces_touched": [
            "notification-service",
            "observability"
          ],
          "artifacts": [
            "docs/notify/mail_slo.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-003",
            "EVID-005",
            "R-20251113-notify-delay",
            "R-20251113-spam"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "notification",
            "slo"
          ]
        }
      }
    },
    "T-20251113-act-004-discord-notify-channel": {
      "seed_id": "ACT-004",
      "title": "实现 Discord 通知通道并评估私信与频道策略",
      "type": "coding",
      "summary": "在本地通知管道中新增 Discord Bot 通道，运行本地 Bot 客户端将课程开放提醒发送给用户或频道，并结合 Q-04 评估“私信 vs 频道广播”的可行性、噪音与速率限制表现，为默认策略提供依据。",
      "acceptance_draft": [
        "在本地或测试服务器中，Bot 能根据数据库内的订阅记录成功向指定用户或频道发送包含课程名、Index 与时间地点的提醒消息。",
        "实现对 Discord API 速率限制的节流与重试逻辑，本地轮询高频触发时仍保持稳定，不出现长期封禁或严重错误。",
        "文档中记录不同通知模式（私信/频道）的优缺点与推荐默认值，并与产品负责人达成一致。"
      ],
      "lane": "next",
      "priority_suggested": "P2",
      "status": "todo",
      "dependencies": [
        "T-20251113-act-009-subscription-management",
        "T-20251113-act-010-local-polling-notify",
        "T-20251113-act-003-mail-notify-function"
      ],
      "blocked": true,
      "blocked_by": [
        {
          "dep_id": "DEP-001",
          "name": "Rutgers SOC API（courses.json / openSections）",
          "type": "api",
          "status": "unknown",
          "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
          "note": "接口结构与速率限制的不确定性会影响 Discord 通知的触发准确性。"
        },
        {
          "dep_id": "DEP-003",
          "name": "Discord Bot API",
          "type": "api",
          "status": "approved",
          "doc_url": "",
          "note": "受速率限制和内容政策约束，过于频繁或模板化的消息可能被限流或封禁。"
        }
      ],
      "unblock_plan": "在本地环境运行 Bot，复用 T-20251113-act-010-local-polling-notify 的事件推送，结合 Discord Sandbox 逐步提升频率以摸清速率限制，再决定默认通知模式。",
      "estimate_h": 6,
      "risk": "mid",
      "confidence": 0.6,
      "interfaces_touched": [
        "local-service",
        "notification-service",
        "discord-bot"
      ],
      "artifacts": [
        "services/notifier/discord_bot.ts",
        "config/discord.json"
      ],
      "citations": [
        "EVID-001",
        "EVID-004",
        "R-20251113-notify-delay",
        "R-20251113-spam"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-004",
        "backend",
        "discord",
        "notification"
      ],
      "subtasks": {
        "T-20251113-act-004-discord-notify-channel-ST-01": {
          "seed_id": null,
          "title": "实现 Discord Bot 客户端与鉴权配置",
          "type": "coding",
          "summary": "构建 notifier/src/discordBot.ts，负责与 Discord Webhook/Bot API 建立连接，并提供注册与健康检查 CLI。",
          "acceptance_draft": [
            "实现 `pnpm ts-node notifier/src/discordBot.ts --health`，在提供 BOT_TOKEN 的情况下完成鉴权并输出可用频道。",
            "支持 `--register-channel <id>` 将目标 channel 或 webhook URL 写入配置表，便于多环境复用。",
            "提供基于 nock 的单元测试，验证鉴权与注册请求 payload。"
          ],
          "lane": "next",
          "priority_suggested": "P2",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-009-subscription-management"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "与需求方讨论 Discord 在通知体系中的角色并形成文件。",
          "estimate_h": 1,
          "risk": "mid",
          "confidence": 0.75,
          "interfaces_touched": [
            "notification-service",
            "discord-bot",
            "product"
          ],
          "artifacts": [
            "docs/notify/discord_strategy.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-004",
            "R-20251113-notify-delay",
            "R-20251113-spam"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "discord",
            "product"
          ]
        },
        "T-20251113-act-004-discord-notify-channel-ST-02": {
          "seed_id": null,
          "title": "接入通知事件总线并格式化消息",
          "type": "coding",
          "summary": "实现 discordNotifier，订阅 polling 服务生成的课程事件，将课号、title、seat delta 等信息格式化为 Markdown 消息并发往目标频道或私信。",
          "acceptance_draft": [
            "在 `notifier/src/discordNotifier.ts` 中监听事件队列，组装消息并支持 DM 与频道两种发送模式。",
            "消息模板支持中英文，允许通过配置覆盖标题、CTA 链接等字段。",
            "新增 `pnpm test discord-notifier`，使用 webhook mock 断言不同事件类型的格式化结果。"
          ],
          "lane": "next",
          "priority_suggested": "P2",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-004-discord-notify-channel-ST-01",
            "T-20251113-act-009-subscription-management"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "在明确角色后，设计 Discord 身份字段与订阅记录的映射。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "notification-service",
            "discord-bot",
            "database"
          ],
          "artifacts": [
            "docs/notify/discord_mapping.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-004",
            "R-20251113-notify-delay",
            "R-20251113-spam"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "discord",
            "subscription"
          ]
        },
        "T-20251113-act-004-discord-notify-channel-ST-03": {
          "seed_id": null,
          "title": "端到端运行脚本与回归测试",
          "type": "coding",
          "summary": "提供 notify:discord 脚本与 docker-compose stub，能够在本地一次性跑通事件→Discord 链路并在 CI 中执行烟囱测试。",
          "acceptance_draft": [
            "在 `docker-compose.yml` 中增加 Discord webhook stub 服务或使用本地 express mock，供 CI 断言。",
            "新增 `pnpm run notify:discord --dry-run` 命令，读取样例事件并发送到 mock 端点。",
            "CI 加入任务运行 notify:discord，并断言 mock 端点收到了预期 payload。"
          ],
          "lane": "next",
          "priority_suggested": "P2",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-004-discord-notify-channel-ST-01",
            "T-20251113-act-004-discord-notify-channel-ST-02"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "结合定位与映射方案，评估风险收益并写出启用策略。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.65,
          "interfaces_touched": [
            "discord-bot",
            "notification-service",
            "ops"
          ],
          "artifacts": [
            "docs/notify/discord_enablement.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-004",
            "R-20251113-notify-delay",
            "R-20251113-spam"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "discord",
            "ops"
          ]
        }
      }
    },
    "T-20251113-act-005-frontend-i18n-setup": {
      "seed_id": "ACT-005",
      "title": "搭建前端 i18n 架构并完成中英文界面",
      "type": "coding",
      "summary": "依据决策 D-20251113-multi-lang-day1，在前端引入标准 i18n 库，将所有静态文案（包括错误提示与表单标签）集中到多语言资源文件中，至少完成中英文版本，并为后续小语种支持预留扩展空间。",
      "acceptance_draft": [
        "所有界面文案均通过 i18n 资源文件管理，不再直接硬编码在组件中。",
        "用户可在 UI 中切换中/英文，切换后界面无混合语言或乱码，课程数据本身保留英文但核心代码/字段标签可本地化说明。",
        "构建或 CI 阶段能检测到新增 key 未提供翻译的情况，并给出告警或失败。"
      ],
      "lane": "next",
      "priority_suggested": "P1",
      "status": "todo",
      "dependencies": [
        "T-20251113-act-002-frontend-filter-mvp"
      ],
      "blocked": false,
      "blocked_by": [],
      "unblock_plan": "",
      "estimate_h": 6,
      "risk": "mid",
      "confidence": 0.75,
      "interfaces_touched": [
        "frontend",
        "i18n"
      ],
      "artifacts": [
        "src/i18n/index.ts",
        "locales/en/*.json",
        "locales/zh/*.json"
      ],
      "citations": [
        "EVID-001",
        "EVID-008",
        "R-20251113-i18n-maintenance"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-005",
        "frontend",
        "i18n",
        "ux"
      ],
      "subtasks": {
        "T-20251113-act-005-frontend-i18n-setup-ST-01": {
          "seed_id": null,
          "title": "引入 i18n 框架与全局 Provider",
          "type": "coding",
          "summary": "安装 react-i18next（或等效库），在应用入口创建 I18n Provider，并提供语言探测与懒加载能力。",
          "acceptance_draft": [
            "新增 `web/src/i18n/index.ts` 初始化多语言实例，在 `App.tsx` 中挂载 I18nextProvider。",
            "提供 `.env` 或配置项决定默认语言与可选语言集合。",
            "编写单元测试验证 Provider 初始化及默认语言 fallback，`pnpm test i18n-provider` 需通过。"
          ],
          "lane": "next",
          "priority_suggested": "P1",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-002-frontend-filter-mvp"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "依照现有 UI 与通知需求梳理所有文案触点，分辨需要翻译与保留原文的范围。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "frontend",
            "i18n",
            "notification-service"
          ],
          "artifacts": [
            "docs/i18n/touchpoints.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-008",
            "R-20251113-i18n-maintenance"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "i18n",
            "ux"
          ]
        },
        "T-20251113-act-005-frontend-i18n-setup-ST-02": {
          "seed_id": null,
          "title": "落地文案资源文件与语言切换组件",
          "type": "coding",
          "summary": "将现有静态文案迁移到 `web/src/locales/{lang}/common.json`，实现语言切换组件并将偏好持久化。",
          "acceptance_draft": [
            "完成至少中英文 common.json，覆盖页面标题、筛选标签、按钮、错误提示等现有文案。",
            "实现 `LanguageSwitcher` 组件并挂载在主导航，能写入 localStorage 并立即触发语言切换。",
            "通过 Storybook 或 RTL 测试验证主要页面在两种语言下都能渲染对应文案。"
          ],
          "lane": "next",
          "priority_suggested": "P1",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-005-frontend-i18n-setup-ST-01"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "在触点梳理完成后，确认语言列表、切换入口与状态持久化方案。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.65,
          "interfaces_touched": [
            "frontend",
            "ux",
            "i18n"
          ],
          "artifacts": [
            "docs/i18n/language_modes.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-008",
            "R-20251113-i18n-maintenance"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "i18n",
            "frontend"
          ]
        },
        "T-20251113-act-005-frontend-i18n-setup-ST-03": {
          "seed_id": null,
          "title": "建立未翻译检测与 CI 保障",
          "type": "coding",
          "summary": "构建 lint:i18n 脚本检测遗漏 key，配套单测与 CI 任务，防止新文案未同步多语言。",
          "acceptance_draft": [
            "添加 `pnpm run lint:i18n` 命令，使用 i18next-parser 或自定义脚本扫描源码并与 locale 文件 diff。",
            "为 lint 逻辑编写单测，覆盖“缺 key”“多余 key”“未使用 key”场景。",
            "在 CI workflow 中新增一步执行 lint:i18n，缺 key 时 PR 直接失败。"
          ],
          "lane": "next",
          "priority_suggested": "P1",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-005-frontend-i18n-setup-ST-01",
            "T-20251113-act-005-frontend-i18n-setup-ST-02"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "在语言模式落定后，敲定 key 命名、文案组织与缺失翻译策略。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "frontend",
            "i18n",
            "docs"
          ],
          "artifacts": [
            "docs/i18n/content_strategy.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-008",
            "R-20251113-i18n-maintenance"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "i18n",
            "docs"
          ]
        }
      }
    },
    "T-20251113-act-006-deploy-docs-cicd": {
      "seed_id": "ACT-006",
      "title": "编写并验证本地一键部署文档与辅助脚本",
      "type": "docs",
      "summary": "围绕“本地数据库 + 轻量 API 服务 + 前端 UI + 后台通知进程”的架构，整理本地部署步骤与环境要求，编写 README 与辅助脚本，使普通用户在个人电脑或服务器上无需修改代码即可初始化数据库、运行 API/前端/通知服务并完成配置。",
      "acceptance_draft": [
        "README 提供针对至少两种主流桌面操作系统（例如 Windows 与 macOS 或 Linux）的本地部署步骤，包含：安装 Node.js/bun、SQLite 或嵌入式数据库依赖、项目初始化、环境变量与密钥配置、如何执行数据库初始化/增量更新脚本，以及如何同时启动前端、API 服务与本地通知进程。",
        "仓库包含可直接使用的本地辅助脚本（例如 scripts/setup_local_env.sh 和 scripts/run_local.sh），在一台全新环境的个人电脑上，用户 clone 仓库后运行脚本即可完成依赖安装校验、数据库初始化、服务启动与通知模块验证。"
      ],
      "lane": "next",
      "priority_suggested": "P1",
      "status": "todo",
      "dependencies": [
        "T-20251113-act-001-soc-json-scraper",
        "T-20251113-act-002-frontend-filter-mvp",
        "T-20251113-act-003-mail-notify-function",
        "T-20251113-act-008-local-query-api",
        "T-20251113-act-009-subscription-management",
        "T-20251113-act-010-local-polling-notify"
      ],
      "blocked": false,
      "blocked_by": [],
      "unblock_plan": "以本地单机运行与容器部署为一等公民目标设计流程：在至少两种主流桌面环境验证脚本可初始化 SQLite、启动 API/前端/通知服务，再整理成 README。",
      "estimate_h": 6,
      "risk": "mid",
      "confidence": 0.7,
      "interfaces_touched": [
        "docs",
        "local-dev",
        "deployment"
      ],
      "artifacts": [
        "README.md",
        ".env.example",
        "scripts/setup_local_env.sh",
        "scripts/run_local.sh"
      ],
      "citations": [
        "EVID-001",
        "EVID-006",
        "EVID-007",
        "R-20251113-oss-governance"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-006",
        "docs",
        "deployment",
        "local-deploy"
      ],
      "subtasks": {
        "T-20251113-act-006-deploy-docs-cicd-ST-01": {
          "seed_id": null,
          "title": "提供一键环境引导脚本",
          "type": "infra",
          "summary": "编写 scripts/bootstrap_env.sh，自动安装 Node/pnpm/SQLite、复制 .env 样例并下载必要的数据，确保开发者在新机器上可一键初始化。",
          "acceptance_draft": [
            "bootstrap 脚本支持 macOS/Linux，自动检测依赖并在缺失时执行包管理命令或给出提示。",
            "脚本会创建 `.env.local` 并填充默认端口/API KEY 占位，同时拉取最新 data/raw 缩减包。",
            "提供 `./scripts/bootstrap_env.sh --verify` 自检模式，运行结果写入 logs/bootstrap.log 并在依赖缺失时返回非零状态。"
          ],
          "lane": "next",
          "priority_suggested": "P1",
          "status": "todo",
          "dependencies": [],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "根据当前实现起草完整部署故事，后续随着功能补全持续更新。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.75,
          "interfaces_touched": [
            "docs",
            "deployment",
            "notification-service"
          ],
          "artifacts": [
            "docs/deploy/success_story.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-006",
            "EVID-007",
            "R-20251113-oss-governance"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "docs",
            "deployment"
          ]
        },
        "T-20251113-act-006-deploy-docs-cicd-ST-02": {
          "seed_id": null,
          "title": "打包本地运行栈并统一启动入口",
          "type": "infra",
          "summary": "使用 docker compose 或 pm2 ecosystem 将 SQLite、API、前端与通知 worker 组合成一键启动的 dev stack。",
          "acceptance_draft": [
            "新增 `docker-compose.yml`（或等效编排）定义 api、web、poller、notifier、mailhog 等服务，并使用共享卷挂载 data/app.db。",
            "提供 `pnpm run dev:stack`/`make dev-up` 封装 compose up -d，并在完成后打印访问链接。",
            "附带 `scripts/check_stack.sh` 健康检查脚本，轮询关键端点并在异常时退出非零状态。"
          ],
          "lane": "next",
          "priority_suggested": "P1",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-006-deploy-docs-cicd-ST-01"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "以成功故事为骨架，拆分并文档化支持环境与阶段性流程。",
          "estimate_h": 3,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "docs",
            "deployment",
            "local-dev"
          ],
          "artifacts": [
            "docs/deploy/flow.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-006",
            "EVID-007",
            "R-20251113-oss-governance"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "docs",
            "deployment"
          ]
        },
        "T-20251113-act-006-deploy-docs-cicd-ST-03": {
          "seed_id": null,
          "title": "CI 部署演练与烟囱测试",
          "type": "infra",
          "summary": "在 CI 中执行 build→compose up→smoke test 的流水线，确保任意提交都能在干净环境拉起整套系统。",
          "acceptance_draft": [
            "新增 `.github/workflows/deploy-smoke.yml`，构建前端与 API 镜像后运行 docker compose。",
            "workflow 内执行 `./scripts/check_stack.sh` 并对 API /courses、前端首页发送 HTTP 请求断言。",
            "将 compose logs 与生成的 .env.example/README 摘要作为 CI artifact 存档。"
          ],
          "lane": "next",
          "priority_suggested": "P1",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-006-deploy-docs-cicd-ST-01",
            "T-20251113-act-006-deploy-docs-cicd-ST-02"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "在流程拆分完成后，为各阶段增加自检与排障章节并形成文档。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "docs",
            "deployment",
            "support"
          ],
          "artifacts": [
            "docs/deploy/troubleshooting.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-006",
            "EVID-007",
            "R-20251113-oss-governance"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "docs",
            "support"
          ]
        }
      }
    },
    "T-20251113-act-007-local-db-schema": {
      "seed_id": "ACT-007",
      "title": "设计本地数据库模式与增量更新机制",
      "type": "coding",
      "summary": "定义 SQLite 等嵌入式数据库中的课程、Section、会议信息与订阅表结构，设计索引与约束，并实现初始化/迁移与增量更新策略，使数据成为筛选与通知的单一可信源。",
      "acceptance_draft": [
        "提供 schema 定义（课程、Section、meeting_times、订阅等表）与必要索引/约束，字段覆盖 FR-01/FR-02/FR-04 所需信息，并附带 ER/说明文档。",
        "实现 scripts/migrate_db.* 可初始化或升级数据库，重复运行不会破坏已有数据；随机抽样记录验证字段与 SOC 返回一致。",
        "定义增量更新策略（例如基于 upsert、事务或临时表交换），在模拟部分课程状态变化的场景下，仅更新发生变化的数据且不中断前端/API 查询。"
      ],
      "lane": "now",
      "priority_suggested": "P0",
      "status": "todo",
      "dependencies": [
        "T-20251113-soc-api-validation"
      ],
      "blocked": true,
      "blocked_by": [
        {
          "dep_id": "DEP-001",
          "name": "Rutgers SOC API（courses.json / openSections）",
          "type": "api",
          "status": "unknown",
          "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
          "note": "接口结构与速率限制需要先通过 T-20251113-soc-api-validation 实测后，才能确定 schema 设计所需字段。"
        }
      ],
      "unblock_plan": "在 T-20251113-soc-api-validation 中确认字段/速率后，设计 schema 与索引并用小样本跑通迁移脚本，再推广到完整数据集。",
      "estimate_h": 8,
      "risk": "mid",
      "confidence": 0.65,
      "interfaces_touched": [
        "database",
        "data-pipeline"
      ],
      "artifacts": [
        "db/schema.sql",
        "scripts/migrate_db.ts",
        "docs/db_schema.md"
      ],
      "citations": [
        "EVID-001",
        "EVID-002",
        "EVID-006",
        "R-20251113-frontend-perf"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-007",
        "backend",
        "database",
        "data-pipeline"
      ],
      "subtasks": {
        "T-20251113-act-007-local-db-schema-ST-01": {
          "seed_id": null,
          "title": "编写 SQLite schema/migrations",
          "type": "coding",
          "summary": "在 schema/migrations 目录创建 SQL，定义 courses、sections、meetings、subscriptions 等表及索引，附带注释说明字段含义。",
          "acceptance_draft": [
            "提供 `schema/migrations/001_init.sql` 等文件，包含建表、索引、触发器以及基础视图。",
            "迁移可通过 `pnpm run migrate -- --db data/app.db` 执行，首次运行会创建 schema_version 记录。",
            "在 `tests/db/migration_smoke.test.ts` 中使用 sqlite-memory 跑迁移并断言关键表与索引存在。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-soc-api-validation"
          ],
          "blocked": true,
          "blocked_by": [
            {
              "dep_id": "DEP-001",
              "name": "Rutgers SOC API（courses.json / openSections）",
              "type": "api",
              "status": "unknown",
              "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
              "note": "接口结构与速率限制需要先通过 T-20251113-soc-api-validation 实测后，才能确定 schema 设计所需字段。"
            }
          ],
          "unblock_plan": "完成 SOC API 参数验证后，编写一次性脚本抓取 Spring 2026 全量数据并固化为原始快照。",
          "estimate_h": 3,
          "risk": "mid",
          "confidence": 0.6,
          "interfaces_touched": [
            "data-source",
            "data-pipeline"
          ],
          "artifacts": [
            "data/raw/spring-2026-courses.json",
            "data/raw/spring-2026-openSections.json",
            "docs/db/sample_notes.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "EVID-006",
            "R-20251113-frontend-perf"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "database",
            "soc-api"
          ]
        },
        "T-20251113-act-007-local-db-schema-ST-02": {
          "seed_id": null,
          "title": "实现迁移运行器与版本管理",
          "type": "coding",
          "summary": "编写 scripts/migrate_db.ts，支持向上/向下迁移、版本锁定与 checksum 校验，保证多环境迁移一致。",
          "acceptance_draft": [
            "migrate_db 支持 `up`、`down`、`status` 子命令，并在 schema_version 中记录执行历史。",
            "运行器具备 checksum 校验，若 SQL 变更会阻止继续执行并提示修复。",
            "为运行器添加单元与 CLI 集成测试，确保重复执行不会破坏现有数据。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-007-local-db-schema-ST-01"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "利用样本数据跑脚本提取字段统计与层级关系，整理成字段字典与结构示意。",
          "estimate_h": 3,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "database",
            "docs"
          ],
          "artifacts": [
            "docs/db/field_dictionary.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "EVID-006",
            "R-20251113-frontend-perf"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "database",
            "analysis"
          ]
        },
        "T-20251113-act-007-local-db-schema-ST-03": {
          "seed_id": null,
          "title": "建立查询与索引性能回归测试",
          "type": "coding",
          "summary": "针对关键查询编写基准脚本和断言，确保 schema 变更不会导致严重性能退化。",
          "acceptance_draft": [
            "新增 `scripts/benchmark_queries.ts`，在 sample 数据下执行课程/section 典型查询并输出耗时。",
            "使用 Jest/Vitest 在 tests/db/perf.test.ts 中设置阈值断言，超过阈值时提示添加索引。",
            "`pnpm run db:test` 将串联迁移、基准与 perf 测试，CI 中执行失败会阻塞合并。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-007-local-db-schema-ST-01",
            "T-20251113-act-007-local-db-schema-ST-02"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "基于样本统计与字段字典，讨论并固化原始快照 + 结构化视图 + 版本演进的概念模型。",
          "estimate_h": 4,
          "risk": "mid",
          "confidence": 0.65,
          "interfaces_touched": [
            "database",
            "data-pipeline",
            "docs"
          ],
          "artifacts": [
            "docs/db/conceptual_model.md",
            "db/schema.sql"
          ],
          "citations": [
            "EVID-001",
            "EVID-002",
            "EVID-006",
            "R-20251113-frontend-perf"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "database",
            "design"
          ]
        }
      }
    },
    "T-20251113-act-008-local-query-api": {
      "seed_id": "ACT-008",
      "title": "实现本地课程查询 API 服务",
      "type": "coding",
      "summary": "基于 SQLite 数据库实现 RESTful API（如 /api/courses、/api/sections、/api/filters），支持多字段过滤、分页与排序，为前端筛选与订阅面板提供一致的数据访问层。",
      "acceptance_draft": [
        "实现至少 /api/courses 与 /api/sections 两个端点，接受 term/campus/subject/关键字/时间/core_code/level 等查询参数，返回 JSON 包含分页信息，任意组合筛选均能得到与数据库一致的结果。",
        "在 4500+ 课程数据规模下，常见查询（含 3~5 个过滤条件）响应时间 < 300 ms，提供必要索引与缓存并通过压测记录指标。",
        "API 提供错误处理与健康检查端点（例如 /api/health），当前端无法连接时能返回明确错误码与原因，便于 UI 友好提示。"
      ],
      "lane": "now",
      "priority_suggested": "P0",
      "status": "todo",
      "dependencies": [
        "T-20251113-act-007-local-db-schema",
        "T-20251113-act-001-soc-json-scraper"
      ],
      "blocked": false,
      "blocked_by": [],
      "unblock_plan": "复用抓取脚本产出的 SQLite 数据，挑选轻量框架（Express/Fastify/FastAPI 等）实现端点，并通过自动化测试覆盖主要组合筛选。",
      "estimate_h": 8,
      "risk": "mid",
      "confidence": 0.7,
      "interfaces_touched": [
        "backend",
        "api",
        "database"
      ],
      "artifacts": [
        "services/api/server.ts",
        "services/api/routes/courses.ts",
        "tests/api/courses.test.ts"
      ],
      "citations": [
        "EVID-001",
        "EVID-006",
        "R-20251113-frontend-perf"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-008",
        "backend",
        "api",
        "database"
      ],
      "subtasks": {
        "T-20251113-act-008-local-query-api-ST-01": {
          "seed_id": null,
          "title": "搭建查询 API 服务骨架与健康检查",
          "type": "coding",
          "summary": "使用 Express/Fastify 等框架创建 api/src/server.ts，完成基础中间件、配置加载与 /healthz 接口。",
          "acceptance_draft": [
            "server 支持从 .env 读取端口、数据库文件路径，并在启动时验证 SQLite 连接。",
            "实现 `GET /healthz` 返回数据库状态、构建版本与最近同步时间。",
            "新增 `pnpm test api-health`，通过 supertest 等工具验证服务能启动并返回 200。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "邀请前端与通知需求参与梳理，整理典型问题并固化成可实现的字段模型。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "api",
            "frontend",
            "notification-service"
          ],
          "artifacts": [
            "docs/api/query_model.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-006",
            "R-20251113-frontend-perf"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "api",
            "design"
          ]
        },
        "T-20251113-act-008-local-query-api-ST-02": {
          "seed_id": null,
          "title": "实现课程/Section 查询与筛选接口",
          "type": "coding",
          "summary": "实现 /api/courses、/api/sections、/api/filters 等端点，支持 term/campus/subject/level/keyword 等多条件筛选与分页。",
          "acceptance_draft": [
            "端点支持 limit/offset、排序、字段选择，并对非法参数返回 400。",
            "查询逻辑使用预编译 SQL 或查询构建器，保证可复用索引。",
            "添加 tests/api/courses.test.ts，在 sqlite-memory fixture 下验证多种筛选组合与分页行为。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-008-local-query-api-ST-01"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "基于查询模型确定端点拆分与参数协议，形成 API 合同文档。",
          "estimate_h": 3,
          "risk": "mid",
          "confidence": 0.65,
          "interfaces_touched": [
            "api",
            "database"
          ],
          "artifacts": [
            "docs/api/contracts.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-006",
            "R-20251113-frontend-perf"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "api",
            "spec"
          ]
        },
        "T-20251113-act-008-local-query-api-ST-03": {
          "seed_id": null,
          "title": "对接缓存与响应优化",
          "type": "coding",
          "summary": "为热门筛选构建缓存/索引，加上 gzip/ETag 与字段投影，提升响应速度并提供监控指标。",
          "acceptance_draft": [
            "实现查询结果缓存（内存或 SQLite 视图），并提供失效策略与命中率日志。",
            "响应头包含 ETag/Cache-Control/Gzip，client 复用时可走 304。",
            "在 tests/api/perf.test.ts 或 k6 脚本中验证 95% 请求在目标延迟内完成，并输出报告。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-008-local-query-api-ST-01",
            "T-20251113-act-008-local-query-api-ST-02"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "结合 API 合同确定错误码与性能预算，与前端/通知方达成一致。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "api",
            "observability"
          ],
          "artifacts": [
            "docs/api/error_budget.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-006",
            "R-20251113-frontend-perf"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "api",
            "observability"
          ]
        }
      }
    },
    "T-20251113-act-009-subscription-management": {
      "seed_id": "ACT-009",
      "title": "实现订阅管理接口与本地存储",
      "type": "coding",
      "summary": "为课程/Section 提供订阅与退订 UI，以及与数据库衔接的 /api/subscribe、/api/unsubscribe 等接口，将用户邮箱/Discord 标识与目标课程索引安全写入本地订阅表。",
      "acceptance_draft": [
        "在课程列表或详情中提供“订阅空位”入口，点击后调用 /api/subscribe 写入数据库，并支持校验输入（邮箱或 Discord 标识）以及重复订阅提示。",
        "实现 /api/unsubscribe（含带签名的退订链接）与订阅列表查询接口，用户可从邮件/Discord 链接或 UI 中退订，数据库记录同步更新。",
        "在本地运行环境中执行一次完整流程（订阅→模拟开放→退订），确认数据库记录、API 响应与通知任务读取到的数据一致。"
      ],
      "lane": "now",
      "priority_suggested": "P0",
      "status": "todo",
      "dependencies": [
        "T-20251113-act-002-frontend-filter-mvp",
        "T-20251113-act-007-local-db-schema",
        "T-20251113-act-008-local-query-api"
      ],
      "blocked": false,
      "blocked_by": [],
      "unblock_plan": "在完成课程列表与 API 基础后，扩展 UI 和接口，编写端到端测试验证订阅/退订流程与数据库同步。",
      "estimate_h": 6,
      "risk": "mid",
      "confidence": 0.7,
      "interfaces_touched": [
        "frontend",
        "api",
        "database",
        "notification-service"
      ],
      "artifacts": [
        "src/components/subscription/*",
        "services/api/routes/subscriptions.ts",
        "db/subscriptions.sql"
      ],
      "citations": [
        "EVID-001",
        "EVID-005",
        "R-20251113-notify-delay"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-009",
        "frontend",
        "backend",
        "notification"
      ],
      "subtasks": {
        "T-20251113-act-009-subscription-management-ST-01": {
          "seed_id": null,
          "title": "实现订阅 CRUD 接口与数据模型",
          "type": "coding",
          "summary": "创建 subscriptions 与 subscription_channels 等表，并提供 /api/subscribe、/api/unsubscribe、/api/subscriptions 端点。",
          "acceptance_draft": [
            "编写 SQL migration 定义订阅表、渠道表及唯一约束，包含邮箱与 Discord 两类渠道字段。",
            "API 层提供创建、取消、查询接口，带输入校验与速率限制。",
            "tests/api/subscriptions.test.ts 覆盖 happy path、重复订阅、非法输入等场景。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-002-frontend-filter-mvp",
            "T-20251113-act-007-local-db-schema"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "结合 schema 与前端需求，统一订阅对象与用户身份的字段定义。",
          "estimate_h": 3,
          "risk": "mid",
          "confidence": 0.65,
          "interfaces_touched": [
            "database",
            "api",
            "frontend"
          ],
          "artifacts": [
            "docs/subscription/model.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-005",
            "R-20251113-notify-delay"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "subscription",
            "design"
          ]
        },
        "T-20251113-act-009-subscription-management-ST-02": {
          "seed_id": null,
          "title": "在前端集成订阅 UI 与状态管理",
          "type": "coding",
          "summary": "实现 SubscribeButton、SubscriptionDrawer 等组件，连通 API 并在本地保存订阅状态。",
          "acceptance_draft": [
            "页面中可针对课程/section 切换订阅，成功后展示提示并更新 UI 徽标。",
            "订阅表单支持邮箱/Discord 两种输入并内建校验，错误时给出 inline 提示。",
            "通过 RTL/Playwright 测试验证 UI 会调用真实 API mock，并能正确处理订阅/退订。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-009-subscription-management-ST-01"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "在明确定义订阅对象后，设计状态流转与需要记录的字段。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "notification-service",
            "database",
            "frontend"
          ],
          "artifacts": [
            "docs/subscription/state_machine.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-005",
            "R-20251113-notify-delay"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "subscription",
            "workflow"
          ]
        },
        "T-20251113-act-009-subscription-management-ST-03": {
          "seed_id": null,
          "title": "串联订阅数据与通知后台",
          "type": "coding",
          "summary": "将订阅 CRUD 与通知/poller 模块打通，生成 email_jobs/discord 队列记录并支持退订生效。",
          "acceptance_draft": [
            "新增触发器或服务逻辑，在订阅创建/取消时更新通知队列映射表。",
            "提供 `pnpm test subscription-pipeline`，模拟订阅→poller 事件→队列入库→退订的闭环。",
            "预置 sample 订阅导入脚本，便于本地快速演示通知效果。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-009-subscription-management-ST-01",
            "T-20251113-act-009-subscription-management-ST-02"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "结合状态机与用户身份设计，定义各入口流程与安全策略。",
          "estimate_h": 3,
          "risk": "mid",
          "confidence": 0.65,
          "interfaces_touched": [
            "frontend",
            "api",
            "security"
          ],
          "artifacts": [
            "docs/subscription/access_points.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-005",
            "R-20251113-notify-delay"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "subscription",
            "security"
          ]
        }
      }
    },
    "T-20251113-act-010-local-polling-notify": {
      "seed_id": "ACT-010",
      "title": "本地空位轮询与通知调度服务",
      "type": "coding",
      "summary": "实现常驻后台任务或定时器，每 30–60 秒轮询 Rutgers openSections 接口，结合本地订阅数据判断课程状态变化，触发事件管道供邮箱/Discord 等通道消费，并处理幂等与错误恢复。",
      "acceptance_draft": [
        "可配置轮询频率与 term/campus 范围，模拟 Section 状态从 Closed→Open 的过程，确认在一个轮询周期内生成事件并写入去重缓存。",
        "同一开放事件最多触发一次通知，短时间内频繁开关的 Section 不会造成重复推送；提供幂等键或状态表来记录已通知事件。",
        "轮询任务具备日志、指标与错误恢复能力（例如网络失败自动重试、进程重启后继续），并可将事件推送到邮箱/Discord 等通道的队列。"
      ],
      "lane": "now",
      "priority_suggested": "P0",
      "status": "todo",
      "dependencies": [
        "T-20251113-act-007-local-db-schema",
        "T-20251113-act-009-subscription-management"
      ],
      "blocked": true,
      "blocked_by": [
        {
          "dep_id": "DEP-001",
          "name": "Rutgers SOC API（courses.json / openSections）",
          "type": "api",
          "status": "unknown",
          "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
          "note": "需要确认 openSections 的速率限制与字段稳定性后才能设定本地轮询与节流策略。"
        }
      ],
      "unblock_plan": "基于 T-20251113-soc-api-validation 成果，选定轮询频率与批量参数，先在小范围 term/campus 上验证事件生成、幂等与日志，再扩展到完整数据集。",
      "estimate_h": 8,
      "risk": "high",
      "confidence": 0.6,
      "interfaces_touched": [
        "local-service",
        "notification-service",
        "scheduler"
      ],
      "artifacts": [
        "services/notifier/poller.ts",
        "services/notifier/event_store.ts",
        "tests/notifier/poller.test.ts"
      ],
      "citations": [
        "EVID-001",
        "EVID-003",
        "R-20251113-notify-delay"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-010",
        "backend",
        "notification",
        "scheduler"
      ],
      "subtasks": {
        "T-20251113-act-010-local-polling-notify-ST-01": {
          "seed_id": null,
          "title": "实现 openSections 轮询调度器",
          "type": "coding",
          "summary": "创建 poller/src/openSectionsPoller.ts，按配置频率调用 SOC openSections API，缓存最近一次响应并写入日志。",
          "acceptance_draft": [
            "poller 支持 `--interval`、`--terms`、`--campuses` 等参数，并可选择串行或并行执行。",
            "每次请求会记录响应哈希与时间，写入 `logs/poller.log`，异常时自动退避重试。",
            "tests/poller/poller.spec.ts 使用 mock API 验证调度节奏与退避策略。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-009-subscription-management",
            "T-20251113-act-007-local-db-schema"
          ],
          "blocked": true,
          "blocked_by": [
            {
              "dep_id": "DEP-001",
              "name": "Rutgers SOC API（courses.json / openSections）",
              "type": "api",
              "status": "unknown",
              "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
              "note": "需要确认 openSections 的速率限制与字段稳定性后才能设定本地轮询与节流策略。"
            }
          ],
          "unblock_plan": "在订阅模型与 DB 字段明确后，结合 openSections 结构定义事件语义。",
          "estimate_h": 3,
          "risk": "mid",
          "confidence": 0.6,
          "interfaces_touched": [
            "notification-service",
            "database"
          ],
          "artifacts": [
            "docs/notify/event_contract.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-003",
            "R-20251113-notify-delay"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "notification",
            "design"
          ]
        },
        "T-20251113-act-010-local-polling-notify-ST-02": {
          "seed_id": null,
          "title": "构建变化检测与事件派发器",
          "type": "coding",
          "summary": "比较最新 openSections 数据与上次快照，识别 seat delta 并向通知队列写入结构化事件。",
          "acceptance_draft": [
            "实现 diff 模块，将课程/section 的容量变化与状态从 raw 数据中计算出来。",
            "派发器将事件写入 SQLite/Redis 队列，包含订阅匹配所需的课程 ID、seat delta、时间戳。",
            "integration 测试模拟两次不同快照，断言仅 seat 变化的课程会触发事件。"
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-soc-api-validation",
            "T-20251113-act-010-local-polling-notify-ST-01"
          ],
          "blocked": true,
          "blocked_by": [
            {
              "dep_id": "DEP-001",
              "name": "Rutgers SOC API（courses.json / openSections）",
              "type": "api",
              "status": "unknown",
              "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
              "note": "需要确认 openSections 的速率限制与字段稳定性后才能设定本地轮询与节流策略。"
            }
          ],
          "unblock_plan": "结合 API 限流数据与事件语义，计算轮询范围并固化策略。",
          "estimate_h": 3,
          "risk": "high",
          "confidence": 0.55,
          "interfaces_touched": [
            "scheduler",
            "notification-service",
            "observability"
          ],
          "artifacts": [
            "docs/notify/polling_strategy.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-003",
            "R-20251113-notify-delay"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "notification",
            "scheduler"
          ]
        },
        "T-20251113-act-010-local-polling-notify-ST-03": {
          "seed_id": null,
          "title": "提供监控指标与回放工具",
          "type": "coding",
          "summary": "为 poller 暴露 metrics/health 接口，并提供 CLI 能够回放历史事件，便于排查通知链路。",
          "acceptance_draft": [
            "实现 HTTP `/metrics` 或 `pnpm ts-node poller/src/pollerMonitor.ts --once`，输出最近轮询时间、成功率等指标。",
            "新增 `pnpm run poller:replay --file snapshots/openSections.json`，可复现历史事件并写入队列。",
            "在 docs 或 README 中记录监控与回放命令，并在 CI smoke 测试中运行 `pnpm run poller:smoke`. "
          ],
          "lane": "now",
          "priority_suggested": "P0",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-010-local-polling-notify-ST-01",
            "T-20251113-act-010-local-polling-notify-ST-02"
          ],
          "blocked": true,
          "blocked_by": [
            {
              "dep_id": "DEP-001",
              "name": "Rutgers SOC API（courses.json / openSections）",
              "type": "api",
              "status": "unknown",
              "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
              "note": "需要确认 openSections 的速率限制与字段稳定性后才能设定本地轮询与节流策略。"
            }
          ],
          "unblock_plan": "结合轮询策略与 API 错误样例，定义降级与恢复流程。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.6,
          "interfaces_touched": [
            "scheduler",
            "observability",
            "notification-service"
          ],
          "artifacts": [
            "docs/notify/poller_failover.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-003",
            "R-20251113-notify-delay"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "notification",
            "reliability"
          ]
        }
      }
    },
    "T-20251113-act-011-mail-sender-module": {
      "seed_id": "ACT-011",
      "title": "邮件发送模块多平台支持",
      "type": "coding",
      "summary": "抽象邮件发送接口并提供至少 SendGrid API 与 SMTP 两种实现，允许通过配置切换，同时支持多语言模板、速率限制与失败重试，以方便不同部署者使用自有邮件服务。",
      "acceptance_draft": [
        "提供统一的 MailSender 接口与配置（API key、SMTP host、发件人等），可在不改代码的情况下切换 SendGrid 与 SMTP，实现都能发送测试邮件。",
        "邮件内容模板支持中英文版本，可注入课程名、Index、订阅者信息等变量；模板缺少翻译或字段时能在构建/测试阶段捕获。",
        "在模拟配额用尽或网络错误时，模块能降级重试或记录清晰错误日志，不会导致主进程崩溃。"
      ],
      "lane": "next",
      "priority_suggested": "P1",
      "status": "todo",
      "dependencies": [
        "T-20251113-act-009-subscription-management"
      ],
      "blocked": false,
      "blocked_by": [],
      "unblock_plan": "在完成订阅存储后，先实现 SendGrid 版本，再扩展 SMTP/本地邮件发送，并接入邮件模板与单元测试。",
      "estimate_h": 5,
      "risk": "mid",
      "confidence": 0.7,
      "interfaces_touched": [
        "notification-service",
        "email-provider",
        "i18n"
      ],
      "artifacts": [
        "services/notify/mail_sender.ts",
        "config/email.example.json",
        "templates/email/*"
      ],
      "citations": [
        "EVID-001",
        "EVID-005",
        "R-20251113-spam"
      ],
      "created_at": "2025-11-13T00:00:00Z",
      "updated_at": "2025-11-13T00:00:00Z",
      "owner": "tbd",
      "tags": [
        "seed:ACT-011",
        "backend",
        "email",
        "notification"
      ],
      "subtasks": {
        "T-20251113-act-011-mail-sender-module-ST-01": {
          "seed_id": null,
          "title": "抽象邮件发送接口与配置系统",
          "type": "coding",
          "summary": "定义 MailProvider 接口与配置加载模块，统一 sender、速率限制与模板变量注入方式。",
          "acceptance_draft": [
            "在 `notifier/src/mail/providers/MailProvider.ts` 中定义 send、ping、close 等接口。",
            "提供 `configs/mail.json` 或环境变量映射，允许在运行时切换 provider 与速率上限。",
            "编写单元测试验证配置解析与 provider 工厂能根据输入返回正确实现。"
          ],
          "lane": "next",
          "priority_suggested": "P1",
          "status": "todo",
          "dependencies": [],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "结合通知需求与现有模板，统一邮件消息模型与发送接口。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.75,
          "interfaces_touched": [
            "notification-service",
            "email-provider",
            "i18n"
          ],
          "artifacts": [
            "docs/notify/mail_sender_interface.md",
            "services/notify/mail_types.ts"
          ],
          "citations": [
            "EVID-001",
            "EVID-005",
            "R-20251113-spam"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "email",
            "design"
          ]
        },
        "T-20251113-act-011-mail-sender-module-ST-02": {
          "seed_id": null,
          "title": "实现 SendGrid 与 SMTP 适配器",
          "type": "coding",
          "summary": "基于 MailProvider 接口完成 SendGrid API 与 SMTP 两种实现，支持模板变量、附件与错误分级。",
          "acceptance_draft": [
            "SendGrid 版本支持自定义 headers、API key 读取与模板变量绑定，并在响应失败时抛出可辨识错误。",
            "SMTP 版本通过 nodemailer（或等效库）实现，支持 TLS 与本地 mailhog。",
            "tests/mail/providers.test.ts 使用 nock/mailhog mock 验证两种实现都能发送样例通知。"
          ],
          "lane": "next",
          "priority_suggested": "P1",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-011-mail-sender-module-ST-01"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "在接口定义后，评估各通道能力并确定优先级与配置策略。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "notification-service",
            "email-provider",
            "deployment"
          ],
          "artifacts": [
            "docs/notify/mail_channels.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-005",
            "R-20251113-spam"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "email",
            "ops"
          ]
        },
        "T-20251113-act-011-mail-sender-module-ST-03": {
          "seed_id": null,
          "title": "实现速率限制、重试与指标上报",
          "type": "coding",
          "summary": "在邮件发送链路中加入速率限制器、指数退避重试与 Prometheus 指标，保障通知稳定。",
          "acceptance_draft": [
            "引入 token bucket 或队列机制，确保单位时间的发送次数不超过配置阈值，并在日志中打印当前速率。",
            "失败任务按指数退避重试，超过阈值写入 dead-letter 表供人工处理。",
            "提供 `/metrics` 或 `pnpm ts-node notifier/src/mailMetrics.ts` 输出发送量、失败率、重试次数，并在 tests/mail/metrics.test.ts 中验证计数。"
          ],
          "lane": "next",
          "priority_suggested": "P1",
          "status": "todo",
          "dependencies": [
            "T-20251113-act-011-mail-sender-module-ST-01",
            "T-20251113-act-011-mail-sender-module-ST-02"
          ],
          "blocked": false,
          "blocked_by": [],
          "unblock_plan": "依据接口与通道能力，设计错误分类、退避与切换策略。",
          "estimate_h": 2,
          "risk": "mid",
          "confidence": 0.7,
          "interfaces_touched": [
            "notification-service",
            "observability",
            "email-provider"
          ],
          "artifacts": [
            "docs/notify/mail_error_handling.md"
          ],
          "citations": [
            "EVID-001",
            "EVID-005",
            "R-20251113-spam"
          ],
          "created_at": "2025-11-13T00:00:00Z",
          "updated_at": "2025-11-13T00:00:00Z",
          "owner": "tbd",
          "tags": [
            "subtask",
            "email",
            "reliability"
          ]
        }
      }
    }
  },
  "questions_for_human": [
    "Q-01：SOC 抓取范围——是否存在官方推荐的一次性抓取全校课程的参数组合（如 subject=ALL），还是必须按院系/subject 逐个请求？如果只能逐个请求，你能接受的完整抓取时长和抓取频率上限是什么？",
    "Q-02：课程基础信息的更新频率——静态课程信息（标题、描述、学分等）每日一次更新是否足够，还是需要在选课高峰期临时提高到每小时/每数小时一次？",
    "Q-03：空位订阅策略——当课程在满员/有空位之间频繁切换时，是只在首次开放时发送一次通知并自动删除订阅，还是每次开放都发送，或允许用户在界面中自定义策略？",
    "Q-04：Discord 通知形态——更偏向 Bot 私信（更即时但可能更易触发限流）还是频道广播（噪音更大但更稳），以及是否已有规划好的服务器/频道用于测试与正式使用？",
    "Q-05：周历“框选时间找课”的语义——你更希望框选的是“上课时间完全落在选中时间段内的课程”，还是“与该时间段不冲突的所有可选课程”？该功能期望在 MVP、v1.1 还是 v2.0 交付？",
    "Q-06：具体覆盖范围——在“需要同时支持多个学期、多校区以及本科/研究生课程”的前提下，MVP 期望最少覆盖哪些 term（例如当前学期 + 下一学期）以及哪些校区组合，以便规划数据抓取批量任务和前端筛选维度？"
  ],
  "assumptions": [
    "假设 Rutgers SOC 公开接口在 2025–2026 学年仍保持可匿名访问，且字段结构与调研时基本一致。",
    "假设 MVP 阶段需要同时覆盖多个学期、多个校区以及本科和研究生课程，主要用户群体为 Rutgers 各校区的在读学生（含本科与研究生）。",
    "假设目标用户可以接受通过邮箱或 Discord 接收课程空位通知，不强依赖短信等其他通知渠道。",
    "假设无需用户登录即可通过带签名的退订链接完成订阅管理，用户能够理解并接受这种轻量级身份验证方式。"
  ],
  "risks": [
    {
      "id": "R-20251113-soc-api-change",
      "summary": "Rutgers SOC API 结构或访问策略变更、速率限制收紧，导致课程数据抓取失败或不完整。",
      "severity": "high",
      "mitigation": "封装独立的数据访问层，增加结构版本检测与失败重试；对调用错误设置监控与告警；预备基于 HTML 页面解析的备选抓取方式，并控制抓取频率以避免触发限流。",
      "citations": [
        "EVID-001",
        "EVID-002"
      ]
    },
    {
      "id": "R-20251113-notify-delay",
      "summary": "课程状态变化与用户收到通知之间的延迟过长，或出现漏报/重复通知，削弱“狙击空位”的价值。",
      "severity": "high",
      "mitigation": "合理设置轮询周期（例如 30–60 秒），优先使用 openSections 等批量接口；在通知管道中实现幂等处理；为关键任务配置心跳与告警，并通过长期测试收集延迟分布与失败率。",
      "citations": [
        "EVID-001",
        "EVID-003",
        "EVID-005"
      ]
    },
    {
      "id": "R-20251113-frontend-perf",
      "summary": "在低端设备或数据量增大时，前端渲染与筛选性能不足，导致明显卡顿或响应超时。",
      "severity": "mid",
      "mitigation": "使用虚拟列表、分页与延迟渲染减少 DOM 压力；优化筛选算法（尽量 O(n) 扫描、必要时排序）；必要时引入 Web Worker 或 WASM，并通过性能脚本持续监控。",
      "citations": [
        "EVID-001",
        "EVID-006"
      ]
    },
    {
      "id": "R-20251113-spam",
      "summary": "邮件或 Discord 消息被用户或平台判定为垃圾信息，导致送达率下降甚至账号/应用被封禁。",
      "severity": "mid",
      "mitigation": "使用成熟邮件服务并正确配置发件域名；控制通知频率与内容个性化；在邮件中提供清晰退订入口与订阅说明；为 Discord Bot 设置速率限制与重试策略，必要时采用频道摘要替代大量私信。",
      "citations": [
        "EVID-001",
        "EVID-003",
        "EVID-004",
        "EVID-005"
      ]
    },
    {
      "id": "R-20251113-i18n-maintenance",
      "summary": "多语言内容维护滞后，新功能上线时部分语言缺失翻译或内容不一致，影响非英文用户体验。",
      "severity": "mid",
      "mitigation": "所有界面文案统一走 i18n 资源文件；在 CI 中加入缺失翻译检查；对未翻译 key 统一回退英文并标记 TODO，定期清理。",
      "citations": [
        "EVID-001",
        "EVID-008"
      ]
    },
    {
      "id": "R-20251113-oss-governance",
      "summary": "开源仓库缺乏持续维护，Issue/PR 堆积或依赖安全漏洞得不到修复，削弱社区信任。",
      "severity": "mid",
      "mitigation": "制定贡献指南与代码规范；配置依赖安全扫描与自动升级工具；鼓励社区维护者参与协作，并在 README 中明确官方维护范围与责任边界。",
      "citations": [
        "EVID-001"
      ]
    }
  ],
  "external_dependencies": [
    {
      "dep_id": "DEP-001",
      "name": "Rutgers SOC API（courses.json / openSections）",
      "type": "api",
      "status": "unknown",
      "doc_url": "https://github.com/anxious-engineer/Rutgers-Course-API",
      "note": "接口无正式公开文档，速率限制与长期稳定性未知；任何结构或访问策略变更都会影响数据抓取与通知准确性。"
    },
    {
      "dep_id": "DEP-002",
      "name": "SendGrid 或同类邮件发送服务",
      "type": "api",
      "status": "approved",
      "doc_url": "",
      "note": "免费额度有限，若用户规模增长可能超限；需要正确配置发件域名与发送策略以降低被判为垃圾邮件的风险。"
    },
    {
      "dep_id": "DEP-003",
      "name": "Discord Bot API",
      "type": "api",
      "status": "approved",
      "doc_url": "",
      "note": "受速率限制和内容政策约束，过于频繁或模板化的消息可能被限流或封禁。"
    },
    {
      "dep_id": "DEP-004",
      "name": "本地运行环境/容器（Node.js + SQLite + 定时任务）",
      "type": "tool",
      "status": "approved",
      "doc_url": "",
      "note": "每个部署实例需要具备运行 Node.js 服务、SQLite 数据库与后台定时任务的能力，可通过本地运行或容器化实现；不再依赖纯静态托管平台。"
    }
  ],
  "facts": [
    "本 JSON 基于 2025-11-11-dr 研究结论整理，数据源为 Rutgers SOC 与相关开源/社区资料。:contentReference[oaicite:0]{index=0}",
    "项目目标是在“浏览筛选课程 + 订阅空位提醒”场景下替代 CSP 和 WebReg 的日常使用体验，而不是替代官方 WebReg 的选课注册流程。",
    "系统统一使用 Rutgers SOC 公开接口（courses.json、openSections 等）作为课程与容量数据来源，不抓取需要登录的 WebReg 页面。",
    "架构采用“本地 SQLite 数据库 + 轻量 API 服务 + 前端 SPA + 本地后台通知”的组合，各部署实例独立运行数据库与通知进程，避免浏览器一次性加载几十 MB JSON。",
    "通知渠道 MVP 聚焦邮箱和 Discord，并通过显式退订/管理入口满足隐私与反垃圾邮件规范。",
    "项目从 day-1 起按多语言架构设计，至少支持中英文 UI，并通过 i18n 资源文件管理文案以方便后续扩展其他语言。"
  ],
  "decisions": [
    {
      "id": "D-20251113-arch-static-frontend-b",
      "summary": "v1.x 阶段采用“本地 SQLite 数据库 + 轻量 API 服务 + 前端 SPA”的一体化架构，而不是继续依赖纯静态前端加载大 JSON 与云函数通知。",
      "rationale": "courses.json 体积已达 20–40 MB，纯前端加载造成性能、带宽与更新成本过高；将数据落地到本地 SQLite，并由轻量 API/后台任务统一负责筛选与通知，可以增量更新、降低前端负担，并保持每个部署实例独立运行。",
      "citations": [
        "EVID-001",
        "EVID-006",
        "R-20251113-frontend-perf",
        "R-20251113-notify-delay"
      ],
      "date": "2025-11-13T00:00:00Z"
    },
    {
      "id": "D-20251113-data-source-soc",
      "summary": "课程与空位数据统一使用 Rutgers SOC 公开接口（courses.json / openSections 等），禁止抓取 WebReg 或需要登录的页面。",
      "rationale": "SOC 提供官方公开的课程与容量数据，是合法且稳定的主要来源；避免抓取需要登录的 WebReg 页面，可以减少合规和技术风险。",
      "citations": [
        "EVID-001",
        "EVID-002"
      ],
      "date": "2025-11-13T00:00:00Z"
    },
    {
      "id": "D-20251113-client-side-filter",
      "summary": "课程筛选与排序主要由嵌入式数据库与本地查询 API 承担，前端仅负责构建条件并展示结果，不再预加载全量数据。",
      "rationale": "在多学期/多校区场景下数据量动辄数千课程，浏览器内存筛选难以兼顾性能与增量更新；利用 SQLite 索引与 API 分页可以维持 <0.5 秒响应并复用同一份数据给通知管道。",
      "citations": [
        "EVID-001",
        "EVID-006",
        "R-20251113-frontend-perf"
      ],
      "date": "2025-11-13T00:00:00Z"
    },
    {
      "id": "D-20251113-notify-channels-email-discord",
      "summary": "通知渠道优先支持邮箱和 Discord，短信等其他渠道暂不在 MVP 范围内。",
      "rationale": "邮件和 Discord 在 Rutgers 学生群体中使用广泛、成本可控且生态成熟；短信成本高且合规复杂，因此在满足 MVP 的前提下优先实现邮箱与 Discord。",
      "citations": [
        "EVID-001",
        "EVID-003",
        "EVID-004",
        "EVID-005"
      ],
      "date": "2025-11-13T00:00:00Z"
    },
    {
      "id": "D-20251113-multi-lang-day1",
      "summary": "项目从 day-1 起按多语言架构设计，至少支持中英文 UI，通过标准 i18n 库管理所有文案。",
      "rationale": "多语言需求在项目初期已被明确，及早引入 i18n 能避免后续大规模重构，同时方便支持小语种学生群体。",
      "citations": [
        "EVID-001",
        "EVID-008"
      ],
      "date": "2025-11-13T00:00:00Z"
    },
    {
      "id": "D-20251113-coverage-multi-term-campus",
      "summary": "MVP 阶段即支持多学期、多校区以及本科/研究生课程的联合浏览与筛选，不以单一校区本科课程为起点。",
      "rationale": "真实选课场景中，学生往往需要在不同学期与不同校区的本科/研究生课程之间做整体规划；从一开始按多维度覆盖设计数据抓取与前端筛选，可以避免后续为扩展范围进行架构级重构。",
      "citations": [
        "EVID-001",
        "Q-06"
      ],
      "date": "2025-11-13T00:00:00Z"
    }
  ]
}
